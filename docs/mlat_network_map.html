<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>ADS-B Research Grid: 3D MLAT Topology</title>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    
    <style>
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; right: 0; left: 0; }
        .panel { 
            position: fixed; bottom: 20px; left: 20px; width: 280px; 
            background: rgba(255, 255, 255, 0.95); padding: 15px; 
            border-radius: 8px; border: 1px solid #ccc; font-family: sans-serif; 
            z-index: 9999; box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        h4 { margin: 0 0 10px 0; color: #2c3e50; font-size: 1.1em; font-weight: bold; }
        .metric { display: flex; justify-content: space-between; font-size: 0.9em; border-bottom: 1px solid #eee; padding: 4px 0; }
    </style>
</head>
<body>
    <div class="panel">
        <h4>ðŸ“¡ Sensor Grid Geometry</h4>
        <div style="font-size: 0.8em; color: #555; margin-bottom: 10px;">
            <b>Triangle Topology:</b><br>
            Three synchronized nodes forming a coverage triangle around Helsinki-Vantaa.
        </div>
        <div class="metric"><span>West â†” North</span><b>29.6 km</b></div>
        <div class="metric"><span>North â†” East</span><b>29.1 km</b></div>
        <div class="metric"><span>East â†” West</span><b>54.2 km</b></div>
        <div class="metric" style="margin-top:5px; border:none; color:green;"><b>Status: OPTIMAL</b></div>
    </div>
    
    <div id="map"></div>

    <script>
        // 1. Initialize Map centered on the Triangle
        var map = L.map("map").setView([60.25, 24.9], 10);
        L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        // 2. Define Nodes
        var nodes = [
            { name: "RX1: West (Kirkkonummi)", lat: 60.120000, lon: 24.400000, color: "orange" },
            { name: "RX2: North (Vantaa Ref)", lat: 60.319555, lon: 24.830816, color: "blue" },
            { name: "RX3: East (Sipoo)",       lat: 60.250000, lon: 25.350000, color: "purple" }
        ];

        // 3. Plot Nodes & Triangle
        var latlngs = [];
        
        nodes.forEach(function(n) {
            // Add Marker
            var icon = L.AwesomeMarkers.icon({
                icon: 'tower-broadcast', prefix: 'fa', markerColor: n.color, iconColor: 'white'
            });
            L.marker([n.lat, n.lon], {icon: icon}).addTo(map).bindTooltip(n.name, {sticky: true});
            
            // Add Label
            var label = L.divIcon({
                className: 'label',
                html: `<div style="background:white; padding:2px 5px; border:1px solid black; border-radius:3px; font-weight:bold; white-space:nowrap;">${n.name}</div>`,
                iconSize: [100, 20], iconAnchor: [-10, 10]
            });
            L.marker([n.lat, n.lon], {icon: label}).addTo(map);

            latlngs.push([n.lat, n.lon]);
        });

        // Close the loop for the polygon
        latlngs.push(latlngs[0]);

        // Draw Triangle
        L.polyline(latlngs, {
            color: '#27ae60', weight: 3, opacity: 0.8, dashArray: '10, 10'
        }).addTo(map);

        L.control.scale().addTo(map);
    </script>
</body>
</html>
