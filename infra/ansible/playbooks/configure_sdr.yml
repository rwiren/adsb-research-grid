---
- name: Configure SDR Hardware via Docker Stack
  hosts: sensors
  become: yes
  gather_facts: yes

  vars:
    # CORRECTED PATH based on your 'find' command
    compose_dir: /opt/adsb-grid

  tasks:
    # 1. Update the Docker Compose file with new Inventory variables (Gain 38.0)
    - name: Update docker-compose.yml from template
      template:
        # Assuming your template is in the relative path below
        src: ../roles/sensor_node/templates/docker-compose.yml.j2
        dest: "{{ compose_dir }}/docker-compose.yml"
        owner: root
        group: root
        mode: '0644'
      notify: Restart Ultrafeeder

  handlers:
    # 2. Restart the container to apply the new settings
    - name: Restart Ultrafeeder
      shell: docker compose up -d --force-recreate ultrafeeder
      args:
        chdir: "{{ compose_dir }}"
