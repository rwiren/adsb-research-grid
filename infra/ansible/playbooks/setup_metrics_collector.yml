---
# ==============================================================================
# File: infra/ansible/playbooks/setup_metrics_collector.yml
# Description: Deploys the Storage Metrics agent.
#              Collects disk usage/growth stats for the health dashboard.
# ==============================================================================

- name: ðŸ“Š Setup Storage Metrics Collector
  hosts: sensors
  become: true
  vars:
    local_script: "../../../scripts/collect_storage_metrics.py"
    remote_script_dir: "/home/{{ ansible_user }}/scripts"

  tasks:
    - name: "[Deploy] Copy Collector Script"
      ansible.builtin.copy:
        src: "{{ local_script }}"
        dest: "{{ remote_script_dir }}/collect_storage_metrics.py"
        mode: '0755'

    - name: "[Schedule] Run Metrics Collector (Every 5 mins)"
      ansible.builtin.cron:
        name: "Run Storage Metrics Collector"
        minute: "*/5"
        job: "/usr/bin/python3 {{ remote_script_dir }}/collect_storage_metrics.py"
