---
- name: "Create data storage directory"
  file:
    path: "/home/pi/adsb_data"
    state: directory
    owner: "pi"
    group: "pi"
    mode: "0755"

# --- ADS-B RECORDER ---
- name: "Deploy ADS-B Recording Script (v1.1)"
  template:
    src: "adsb_record.sh.j2"
    dest: "/home/pi/adsb_record.sh" # Kept in home as per your existing setup
    owner: "pi"
    group: "pi"
    mode: "0755"

- name: "Deploy ADS-B Recorder Service"
  template:
    src: "adsb-recorder.service.j2"
    dest: "/etc/systemd/system/adsb-recorder.service"
    mode: "0644"
  notify: restart adsb-recorder

# --- GNSS RECORDER (NEW) ---
- name: "Deploy GNSS Recording Script"
  template:
    src: "gnss_record.sh.j2"
    dest: "/usr/local/bin/gnss_record.sh"
    owner: "pi"
    group: "pi"
    mode: "0755"

- name: "Deploy GNSS Recorder Service"
  template:
    src: "gnss-recorder.service.j2"
    dest: "/etc/systemd/system/gnss-recorder.service"
    mode: "0644"
  notify: restart gnss-recorder

# --- SERVICE CONTROL ---
- name: "Ensure Recorders are Enabled and Started"
  systemd:
    name: "{{ item }}"
    enabled: yes
    state: started
    daemon_reload: yes
  loop:
    - adsb-recorder
    - gnss-recorder
