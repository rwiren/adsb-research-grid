version: '3.8'
# Version: 2.0.0
# Description: Final Verified State. Fixed SDR Serial + Redundant Location Vars.

services:
  # --- CORE FEEDER (Ultrafeeder) ---
  ultrafeeder:
    image: ghcr.io/sdr-enthusiasts/docker-adsb-ultrafeeder:latest
    container_name: ultrafeeder
    hostname: ultrafeeder
    restart: unless-stopped
    device_cgroup_rules:
      - 'c 189:* rwm'
    ports:
      - "8080:80"        # Tar1090 Web Interface
      - "30005:30005"    # Beast Output
    environment:
      # --- General Settings ---
      - LOGLEVEL=error
      - TZ={{ timezone }}
      
      # --- Location (REDUNDANT MAPPING) ---
      # Fixes the "North Sea" 0.00 issue
      - LAT={{ lat }}
      - LON={{ lon }}
      - READSB_LAT={{ lat }}
      - READSB_LON={{ lon }}
      - ALT={{ alt }}

      # --- SDR Config ---
      - READSB_DEVICE_TYPE=rtlsdr
      # Mapped to '00001000' in host_vars
      - READSB_RTLSDR_DEVICE={{ sdr_serial | default('0') }}
      - READSB_RTLSDR_PPM={{ adsb_ppm }}
      - READSB_GAIN={{ adsb_gain }}

    volumes:
      - /dev:/dev:ro
      - /run/readsb:/run/readsb
      - /var/run/docker.sock:/var/run/docker.sock
      - /var/lib/sb_graph:/var/lib/sb_graph
