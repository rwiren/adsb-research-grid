version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # Ultrafeeder: The main ADS-B decoder/feeder container
  # ---------------------------------------------------------------------------
  ultrafeeder:
    image: ghcr.io/sdr-enthusiasts/docker-adsb-ultrafeeder:latest
    container_name: ultrafeeder
    restart: always
    hostname: ultrafeeder
    tty: true
    device_cgroup_rules:
      - 'c 189:* rwm'
    environment:
      # -----------------------------------------------------------------------
      # HARDWARE CONFIGURATION
      # Pulled from Ansible Inventory (hosts.prod)
      # -----------------------------------------------------------------------
      - LOGLEVEL=error
      - READSB_DEVICE_TYPE={{ sdr_type | default('rtlsdr') }}
      - READSB_GAIN={{ sdr_gain | default('autogain') }}
      
      # -----------------------------------------------------------------------
      # LOCATION CONFIGURATION
      # Ensure these are defined in your group_vars or inventory
      # -----------------------------------------------------------------------
      - LAT={{ sensor_lat | default('60.319555') }}
      - LONG={{ sensor_lon | default('24.830816') }}
      
      # -----------------------------------------------------------------------
      # VISUALIZATION
      # -----------------------------------------------------------------------
      - UPDATE_TAR1090=true
      - TAR1090_DEFAULTCENTERLAT={{ sensor_lat | default('60.319555') }}
      - TAR1090_DEFAULTCENTERLON={{ sensor_lon | default('24.830816') }}
      - TAR1090_MESSAGERATEINTITLE=true

    volumes:
      - /opt/adsb/ultrafeeder/globe_history:/var/globe_history
      - /opt/adsb/ultrafeeder/graphs1090:/var/lib/collectd
      - /proc/diskstats:/proc/diskstats:ro
      - /dev:/dev:ro
    
    ports:
      - 8080:80       # Tar1090 Web Interface
      - 30005:30005   # Beast Output (Raw Data)
    
    tmpfs:
      - /run:exec,size=64M
      - /var/log
