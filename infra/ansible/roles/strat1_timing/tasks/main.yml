---
# Role: strat1_timing
# Description: Configures Chrony to use GPS+PPS for Stratum 1 accuracy.

- name: "[Time] Install Chrony"
  apt:
    name: chrony
    state: present
    update_cache: yes

- name: "[Time] Deploy Scientific Chrony Config"
  template:
    src: chrony.conf.j2
    dest: /etc/chrony/chrony.conf
    mode: '0644'
  notify: restart chrony

- name: "[Time] Ensure Chrony is enabled and running"
  systemd:
    name: chrony
    enabled: yes
    state: started

# Tweaking the kernel for low-latency GPIO processing (Optional but good for PPS)
- name: "[System] Low Latency tuning"
  sysctl:
    name: kernel.sched_rt_runtime_us
    value: '-1'
    state: present
