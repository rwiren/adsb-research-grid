---
# -----------------------------------------------------------------------------
# [FILE] infra/ansible/roles/tower_core/handlers/main.yml
# [DESCRIPTION] Handlers for the Tower Core role
# [VERSION] v1.1.0 (Added Grafana & Logstash)
# -----------------------------------------------------------------------------

- name: Restart Tower Stack
  community.docker.docker_compose_v2:
    project_src: /opt/tower
    state: restarted

- name: Restart Syslog
  ansible.builtin.service:
    name: rsyslog
    state: restarted
  become: yes

- name: Restart OpenSearch Stack
  community.docker.docker_compose_v2:
    project_src: /opt/adsb-grid/opensearch
    state: restarted
  become: yes

- name: Restart Fluent Bit
  service:
    name: fluent-bit
    state: restarted

# ✅ Added for Tower Logging Migration
- name: Restart Logstash
  service:
    name: logstash
    state: restarted

# ✅ Added for Grafana Setup
- name: Restart Grafana
  service:
    name: grafana-server
    state: restarted

- name: Reload Systemd
  systemd:
    daemon_reload: yes
